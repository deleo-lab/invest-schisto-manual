{
  "hash": "31c47957dbc3fe8241d8457c563a1ea4",
  "result": {
    "markdown": "---\ntitle: \"Understanding the model inputs\"\ndescription: \"Details on the model parameters and how the model works\"\ndate: 02-05-2025 #important if sorting by date in tutorials\ncategories: [InVEST, Quickstart, Parameters] #rough ideas if want tags\nimage: plugin_blank.png #must be in this folder\ndraft: true #true until ready to post\n---\n\n\n\n\n## Background  \n\nThe backbone of the InVEST Schistosomiasis tools is recreating the production functions presented in [Waltz et al., 2015](https://doi.org/10.1371/journal.pntd.0004217). The underlying mechanistic model create a habitat suitability index based off remotely sensed habitat variables in a users area of interest. The relationship between some of these parameters and the habitat suitablity can be changed by the user in the InVEST workbench, others the users can define.\n\nTo get started the inputs needs to be in a project folder. Details on how to build these inputs for yourself are in [future tutorial link]{style=\"color: red;\"}. For the purpose of this tutorial we are going to use the Senegal sample data available on [Google Drive]() in `senegal_inputs.zip`. Download and unzip the file to your project folder. More details on how to download and unzip are provided in [Running sample models](../tutorials/02_sample_data/index.qmd). For this tutorial you don't need the `invest_schistosomiasis_senegal_datastack` folder or to load the `.json` file as described in the other tutorial. We are going to specify the parameters ourselves and create our own `.json` run files.  \n\n## Workbench  \n\n![Screenshot of workbench](plugin_blank.png){width=600}\n\nWhen first opened the Schistosomiasis plugin looks like this. Each of the red boxes require an input from the user. Short descriptions of these are provided by clicking the &#128712; icons. Details on how to fill the red boxes and the underlying functions are detailed below. \n\n### Workspace (directory)  \n\nThe workspace is the folder where all the model's output files will be written. If this folder does not exist, it will be created. If data already exists in the folder, it will be overwritten.  \n\nClick the `folder icon`, then navigate to where you want the model to be saved. In the screenshot I am saving it to a folder called `senegal_example_inputs`. Click `Select Folder` and the box will now contain the path to that folder.\\\n![screenshot setting up workspace](01_workspace.png){width=600}\n\n### File Suffix (string, optional)  \n\nOption to add a suffix to model outputs to help keep track of different run. I'm using today's date as a sting YYYYMMDD (20260205) so the runs will be saved in order.  \n\n### Area Of Interest (vector)  \n\nThe Area of Interest (AOI) is a polygon of the area where you want the predictions and have the input data. For this example the AOI is the Senegal River Basin and the shapefile was provided in the `senegal_inputs` folder downloaded from Google Drive.  \n\nClick the `folder icon`, navigate the `senegal_inputs/projected_sen_aoi.gpkg`, and click `Open`. Use this same process to load all of the files described below.  \n\nHere is what the AOI for the Senegal River Basin sample data looks like.\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n### Max decay distance (number) (m)\n\nThe maximum threat distance from water risk in meters The risk decays 1 $\\to$ 0 from 1km from water to the input max distance to water value linearly. *How far from water do you expect a population to be impacted?* \n\nThe function for proximity to water was based on a combination of literature and expert opinion. Households near schistosome-containing water bodies tend to have higher schistosomiasis prevalence than those far away ([Huang and Manderson 1992](https://doi.org/10.1016/0001-706x(92)90037-x)). This relationship has been studied in Kenya, Ghana and Brazil and summarized into four risk categories based on a residenceâ€™s proximity to freshwater: very high (<100 m), high (101-500 m), low (501-1,000 m) and very low (1,001-2,000 m) ([Ajakaye et al. 2017](https://doi.org/10.1371/journal.pntd.0005733)). Based on field experience, people living in the arid Senegal River Basin travel farther to water (personal communication with Giulio De Leo and Andy Chamberlin), so the risk categories at this site were scaled up to: total (<1 km), linearly declining (1-15 km), and negligible (>15 km). This categorization is supported by a study in Kenya which found no correlation between proximity and prevalence for schools within 1 km of water ([Nagi et al. 2014](https://doi.org/10.1371/journal.pntd.0002991)).\n\nEssentially, in northern Senegal surface water is quite limited (Sahel Desert) so we expect people to travel quite far to access water points. Therefore, 5 km (5000m) is a reasonable estimate for maximum distance (`max decay distance = 5000`).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n### Water Presence (raster)  \nA raster indicating presence of water called `projected_basin_water_mask_nodata_sen.tif` in the sample data. The water mask data here is based on [Andy add citation]{style=\"color: red;\"} and shows water presence/absenece in 30x30 meter pixels. The water mask is potentially the most important part of the model as risk will be underestimated for an area if the water presence raster indicates there is no water, but in truth small water bodies are present. Notice in the plot the Senegal river, which runs along the Mauritania-Senegal boarder and Lac de Guiers are clearly shown.  \n\n[I can change this to be interactive so the user and zoom in and see small water pixels]{style=\"color: red;\"}\n\n\n\n\n### Population \n\n#### Population Raster (raster) (m)  \n\n[Why is there an \"m\" in this title?]{style=\"color: red;\"}  \n\nA raster representing the number of inhabitants per pixel called `population_count_projected.tif`. The population data in this tutorial is from [Andy add citation]{style=\"color: red;\"} and shows the population estimates in ~1km pixels from [YEAR]{style=\"color: red;\"}. The population estimates are used to estimate the convoluted/population at risk estimates. It's a bit hard to see because most of Senegal has a low population density, but Saint Louis (coast directly left of AOI) has a much higher population estimate. \n\n\n::: {.cell}\n\n```{.r .cell-code}\npopu <- rast(paste0(fp, \"population_count_projected.tif\"))\n\npbase +\n  geom_spatraster(data=popu)+\n  scale_fill_fermenter(na.value = \"transparent\")+\n  geom_spatvector(data=aoi, color=\"red\", fill=\"transparent\", lwd=1)+\n  geom_text(aes(x=(xmin(aoi)+7e4), y=ymin(aoi)+5e4, label=\"AOI\"), size=8)+\n  labs(fill=\"population\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n#### Use Default Population Suitability (optional)\n\n[population is misspelled!]{style=\"color: red;\"} \n\nSlide bar with the option to Use the Default Population Suitability (slide right) or input your own function (slide left). The default option is a linear increase in risk to rural max and an s-curve decrease in risk from rural max to urbanization max.\n\n::: {.cell}\n\n```{.r .cell-code}\nrural_max = 1000\nurban_max = 25000\n\nh_range = urban_max - rural_max\nmidpoint <- rural_max + h_range/2\nk = 10 / h_range\n\ndata.frame(h=seq(0, 3e4, by=1000)) %>% \n  mutate(linear_scurve =case_when(h<2 ~ 0,\n                                  h<=rural_max ~ rural_max/h,\n                                  h>rural_max ~ 1/(1 + exp(k * (h - midpoint))),\n                                  TRUE ~ 0)) %>% \n  ggplot(aes(x=h, y=linear_scurve)) +\n  geom_line()+\n  labs(x=bquote(\"Human population per \"(km^2)),\n       y=\"Relative transmission risk\",\n       title=\"Default population suitability function\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nIf the default is used the next two options are `Rural Population Max` and `Urbanization Population Max`.\\ \n![screenshot of default population suitabilty](pop_suitability_default.png)  \\\n\nFor the tutorial use `Rural Population Max` = `1000` and `Urbanization Population Max` = `25000`. These values are based on at what respective population density you expect risk to be highest (1; rural) and lowest (0; urban). [Andy confirm this:]{style=\"color: red;\"} We estimated these values based on our local knowledge of at what population density transmission is highest before WASH measure are implemented and our estimate at which population density people are not exposed to surface water around their homes (e.g. city with piped water and plumming).  \n \n#### Don't Use Default Population Suitability (optional)  \n\nIf the default option is not used the function and parameters need to be provided.  \n![screenshot of not default population suitabilty](pop_suitability_nodefault.png)  \\\n\nThe `Suitability Function Type` needs to be defined for both `Rural` and `Urbanization` using the drop down menus. Then for each function various parameters need to be defined.  \n\n| function | rural | urban |  \n| --- | --- | --- |  \n| `Linear` | Four points indicating the start (`Xa`, `Ya`) and end (`Xz`, `Yz`) of the line where `Xa`=min population size, `Ya`=risk at Xa, and `Xz`=max rural population size with the respective max risk (`Yz`, typically 1) | same idea in reverse |  \n| `exponential` | `Yin` = ..., `Xmed`=..., `Decay_factor`=..., `Max_dist`=... | ...|  \n| `scurve` (sigmoidal) | `Yin`=..., `Yfin`=..., `Xmed`=..., `Inv_slope`=... | ... |  \n| `trapezoid` | each is a point `a`=..., `b`=..., `c`=..., `z`=..., of the trapazoid | ...|  \n| `gaussian` | `Mean`=..., `Std`=..., `Lb` =..., `Ub` =... | ...|  \n\n[Here I completely don't understand how the trapezoid would work / how two linear functions are different from a trapezoid]{style=\"color: red;\"}\n\n[helpful to add some plots here explaining more?]{style=\"color: red;\"}\n\n### Calculate Water Depth (optional)  \nWater depth is calculated using the water presence raster input and water distance from shore as a proxy for depth.\n\nFor the tutorial we are going to `Enable` this (slide to right) then fill in the `Water Depth Risk Weight (ratio: a decimal from 0-1)` = `1`. The weight this factor should have on overall risk.  \n\n### Calculate Water Temperature (optional)  \n\n`Enable` and so that water temperature effects are calculated. Now a series of rasters and ratio inputs are needed. \n\n\n#### Dry/ Season Temperature Raster (raster)  \n\nRasters of air temperature in &deg;C during the dry and wet seasons. These are called `projected_habsuit_waterTemp_dry_2019_sen.tif` and `projected_habsuit_waterTemp_wet_2019_sen.tif` respectively. \n\n#### Snail Water Temp Dry & Wet Risk  \n\nA ratio [0,1] of the temperature associated risk to snails in the dry and wet seasons. \n\nFor the tutorial set both of these to `1`. \n\n#### Snail Suitabililty Function Types  \n\nHere is where you choose the snail of interest and thus which species of Schistosoma the model is for. Remember *Bulinus truncatus* $\\to$ *S. haematobium* and *Biomphalaria* $\\to$ *S. mansoni*. The different snail genera have different thermal envelopes thus this will change the risk-temperature relationship. Alternatively, a function (linear, exponential, scurve, trapazoidal, gaussian) with the parameters decribed above can be used. \n\nAgain, set the `Risk weight` in the model for these parameters to `1`. \n\n## stopped here  \n\n\n## notes from Andy  \nhttps://github.com/Bushytop/schisto_eeid/tree/main/data/natcap_invest\nhttps://colab.research.google.com/drive/1Gj8zyo4nE2ij10aNuoXjx3yiYCTGy5tR?usp=sharing#scrollTo=dylSqiUUwmA8\n[7:52 AM]in particular, the parameters to use for consistency are:\nmax decay distance: 5000\nuse default population suitability (enable)\nrural population max: 1000\nurbanization population max: 25000\ncalculate water depth (enable)\nwater depth risk weight: 1\ncalculate water temperature (enable)\nall risk weights set to 1\ndefault snail and parasite suitability function types\ncalculate ndvi (enable)\ndefault ndvi suitability function\nndvi risk weight: 1 for both dry and wet\nwater velocity disabled and no other functions defined\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}